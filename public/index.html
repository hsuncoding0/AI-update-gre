<!doctype html>
<html lang="zh-Hant">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>GitHub Repo Explorer — 豪華強化版</title>

  <!-- Tailwind CDN -->
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- highlight.js -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github-dark.min.css">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>

  <link rel="stylesheet" href="/styles.css" />
</head>
<body class="bg-slate-50 dark:bg-slate-900 text-slate-800 dark:text-slate-100 transition-colors duration-300">
  <div class="max-w-7xl mx-auto p-6">
    <header class="flex items-center justify-between mb-6">
      <div>
        <h1 class="text-2xl font-bold flex items-center gap-3">
          <svg class="w-8 h-8 text-sky-500 animate-bounce-slow" viewBox="0 0 24 24" fill="none"><path d="M12 2L3 7l9 5 9-5-9-5z" fill="currentColor"/></svg>
          GitHub Repo Explorer
          <span class="text-sm text-slate-400 ml-2">豪華強化版</span>
        </h1>
        <div class="text-sm text-slate-400">進度、動畫、行號、搜尋高亮、分支清單與更穩健的錯誤處理。</div>
      </div>

      <div class="flex items-center gap-3">
        <div class="text-sm text-slate-400">主題</div>
        <button id="themeToggle" class="p-2 rounded bg-slate-200 dark:bg-slate-800">
          <svg id="themeIcon" class="w-5 h-5" viewBox="0 0 24 24" fill="none"><path d="M12 3v2M12 19v2M4.2 4.2l1.4 1.4M18.4 18.4l1.4 1.4M1 12h2M21 12h2M4.2 19.8l1.4-1.4M18.4 5.6l1.4-1.4" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/></svg>
        </button>
      </div>
    </header>

    <section class="mb-4 bg-white dark:bg-slate-800 p-4 rounded-lg shadow-sm">
      <div class="flex gap-3 items-center">
        <input id="owner" class="border rounded px-3 py-2 w-56 bg-transparent" placeholder="owner (e.g. torvalds)" />
        <input id="repo" class="border rounded px-3 py-2 w-56 bg-transparent" placeholder="repo (e.g. linux)" />
        <select id="branchSelect" class="border rounded px-3 py-2 bg-transparent w-48">
          <option value="">branch (optional)</option>
        </select>
        <button id="loadBtn" class="ml-2 bg-sky-600 hover:bg-sky-700 text-white px-4 py-2 rounded shadow">Load</button>

        <div class="ml-auto flex items-center gap-2">
          <input id="searchBox" placeholder="搜尋檔名或路徑 (Ctrl/Cmd+K)" class="border rounded px-3 py-2 w-64 bg-transparent" />
          <button id="clearSearch" class="text-sm text-slate-400">清除</button>
        </div>
      </div>

      <div id="progressWrap" class="mt-3 hidden">
        <div class="flex items-center gap-3">
          <div id="progressText" class="text-sm text-slate-600">載入中...</div>
          <div class="flex-1">
            <div class="w-full bg-slate-200 h-2 rounded overflow-hidden">
              <div id="progressBar" class="h-2 rounded bg-gradient-to-r from-sky-500 to-indigo-600 w-0 transition-all duration-300"></div>
            </div>
          </div>
          <div id="spinner" class="w-6 h-6 animate-spin-slow border-4 border-slate-200 rounded-full border-t-sky-500"></div>
        </div>
      </div>
    </section>

    <main class="grid grid-cols-4 gap-6">
      <aside class="col-span-1 bg-white dark:bg-slate-800 p-4 rounded-lg shadow-sm h-[72vh] overflow-auto">
        <div class="flex items-center justify-between mb-2">
          <div class="text-sm text-slate-500">檔案樹</div>
          <div class="text-xs text-slate-400">點擊檔案以檢視</div>
        </div>
        <div id="tree" class="text-sm"></div>
      </aside>

      <section class="col-span-3 bg-white dark:bg-slate-800 p-4 rounded-lg shadow-sm h-[72vh] overflow-auto flex flex-col">
        <div class="flex items-center gap-4 mb-3">
          <div id="breadcrumbs" class="text-sm text-slate-500 flex-1"></div>
          <div class="flex gap-2">
            <button id="downloadBtn" class="text-sm px-3 py-1 border rounded">下載</button>
            <button id="copyBtn" class="text-sm px-3 py-1 border rounded">複製</button>
          </div>
        </div>

        <div class="flex-1 overflow-auto bg-slate-900 text-slate-100 rounded p-3 code-wrap">
          <pre id="codePre" class="relative"><code id="code" class="hljs block whitespace-pre-wrap"></code></pre>
        </div>

        <div id="snack" class="fixed bottom-6 right-6 hidden bg-slate-800 text-white px-4 py-2 rounded shadow">已複製到剪貼簿</div>
      </section>
    </main>

    <footer class="mt-4 text-xs text-slate-400">提示：如遇 API 速率限制，請在後端設定 GITHUB_TOKEN。</footer>
  </div>

  <script src="/app.js"></script>
  <script>hljs.highlightAll();</script>
</body>
</html>
